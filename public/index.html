<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaGrabber - Video Downloader</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #252538 0%, #383850 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(139, 92, 246, 0.25), transparent),
                radial-gradient(ellipse 60% 40% at 100% 100%, rgba(99, 102, 241, 0.2), transparent);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 720px;
            margin: 0 auto;
            padding: 48px 24px;
        }

        header {
            text-align: center;
            margin-bottom: 48px;
            position: relative;
        }

        .settings-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 0.02em;
            margin-bottom: 16px;
        }

        .settings-btn:hover {
            background: rgba(139, 92, 246, 0.15);
            border-color: rgba(139, 92, 246, 0.3);
            color: rgba(255, 255, 255, 0.9);
        }

        .settings-btn span {
            font-size: 14px;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            border-radius: 20px;
            margin-bottom: 24px;
            box-shadow: 0 20px 40px -12px rgba(99, 102, 241, 0.4);
        }

        .logo svg {
            width: 36px;
            height: 36px;
            fill: white;
        }

        h1 {
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: #fff;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.5);
            font-size: 1rem;
            font-weight: 400;
        }

        .platforms {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .platform-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.2s;
        }

        .platform-badge:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .platform-badge.active.youtube {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
            color: #fff;
        }

        .platform-badge.active.instagram {
            background: rgba(228, 64, 95, 0.2);
            border-color: #e4405f;
            color: #fff;
        }

        .platform-badge.active.facebook {
            background: rgba(24, 119, 242, 0.2);
            border-color: #1877f2;
            color: #fff;
        }

        .platform-badge.active.googleads {
            background: rgba(66, 133, 244, 0.2);
            border-color: #4285f4;
            color: #fff;
        }

        .platform-badge svg {
            width: 16px;
            height: 16px;
        }

        .input-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(20px);
        }

        .input-group {
            display: flex;
            gap: 12px;
        }

        input[type="text"], input[type="password"] {
            flex: 1;
            padding: 16px 20px;
            font-size: 0.95rem;
            font-family: inherit;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            background: rgba(0, 0, 0, 0.4);
            color: #fff;
            outline: none;
            transition: all 0.2s;
        }

        input[type="text"]:focus, input[type="password"]:focus {
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        input[type="text"]::placeholder, input[type="password"]::placeholder {
            color: rgba(255, 255, 255, 0.25);
        }

        button {
            padding: 16px 28px;
            font-size: 0.95rem;
            font-weight: 600;
            font-family: inherit;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: #fff;
            box-shadow: 0 4px 16px -4px rgba(99, 102, 241, 0.5);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px -4px rgba(99, 102, 241, 0.6);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-section {
            display: none;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 20px;
            padding: 24px;
            animation: slideUp 0.4s ease;
            backdrop-filter: blur(20px);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .video-preview {
            margin-bottom: 20px;
            border-radius: 16px;
            overflow: hidden;
            background: #000;
        }

        .video-preview video {
            width: 100%;
            max-height: 400px;
            display: block;
        }

        .video-info {
            margin-bottom: 20px;
        }

        .video-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: #fff;
            line-height: 1.4;
        }

        .video-platform {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .video-platform.youtube {
            background: rgba(255, 0, 0, 0.15);
            color: #ff4444;
        }

        .video-platform.facebook {
            background: rgba(24, 119, 242, 0.15);
            color: #4c9aff;
        }

        .video-platform.instagram {
            background: rgba(228, 64, 95, 0.15);
            color: #f06595;
        }

        .video-platform.googleads {
            background: rgba(66, 133, 244, 0.15);
            color: #6ea8fe;
        }

        .download-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-download {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
            box-shadow: 0 4px 16px -4px rgba(16, 185, 129, 0.5);
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px -4px rgba(16, 185, 129, 0.6);
        }

        .btn-copy {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }

        .btn-copy:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .btn-transcribe {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: #fff;
            box-shadow: 0 4px 16px -4px rgba(139, 92, 246, 0.5);
            white-space: nowrap;
            min-width: 130px;
        }

        .btn-transcribe:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px -4px rgba(139, 92, 246, 0.6);
        }

        .btn-transcribe:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        #transcribeLang {
            transition: all 0.2s;
        }

        #transcribeLang:hover {
            border-color: rgba(139, 92, 246, 0.5);
            background: rgba(139, 92, 246, 0.15);
        }

        #transcribeLang:focus {
            border-color: rgba(139, 92, 246, 0.6);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        #transcribeLang option {
            background: #1a1a2e;
            color: #fff;
            padding: 8px;
        }

        .transcribe-section {
            margin-top: 20px;
            background: rgba(139, 92, 246, 0.08);
            border: 1px solid rgba(139, 92, 246, 0.15);
            border-radius: 16px;
            padding: 20px;
        }

        .transcribe-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .transcribe-header h4 {
            color: #a78bfa;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0;
        }

        .btn-copy-small {
            padding: 8px 14px;
            font-size: 0.8rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-copy-small:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .transcribe-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.8;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .transcribe-loading {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #a78bfa;
            font-size: 0.9rem;
        }

        .transcribe-loading .spinner {
            width: 20px;
            height: 20px;
            border-width: 2px;
            margin: 0;
            flex-shrink: 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 60px 40px;
        }

        .spinner {
            width: 44px;
            height: 44px;
            border: 3px solid rgba(255, 255, 255, 0.08);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        .loading p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            display: none;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            padding: 16px 20px;
            border-radius: 14px;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        .success-message {
            display: none;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
            padding: 16px 20px;
            border-radius: 14px;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        footer {
            text-align: center;
            margin-top: 48px;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.85rem;
        }

        /* Auth Banner Styles */
        .auth-banner {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(228, 64, 95, 0.15);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(20px);
        }

        .auth-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .auth-icon {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, rgba(228, 64, 95, 0.15), rgba(131, 58, 180, 0.15));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-title h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }

        .auth-title p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .auth-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px;
            border-radius: 12px;
        }

        .auth-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.5);
            border-radius: 9px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .auth-tab:hover {
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.05);
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #e4405f, #833ab4);
            color: #fff;
            box-shadow: 0 4px 12px rgba(228, 64, 95, 0.3);
        }

        .auth-content-wrapper {
            min-height: 180px;
        }

        .auth-content {
            animation: fadeIn 0.3s ease;
        }

        .auth-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 28px;
            text-align: center;
        }

        .auth-card-icon {
            width: 72px;
            height: 72px;
            margin: 0 auto 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }

        .auth-card p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .btn-auth-action {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, #e4405f, #833ab4);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 16px -4px rgba(228, 64, 95, 0.5);
        }

        .btn-auth-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px -4px rgba(228, 64, 95, 0.6);
        }

        .cookie-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .cookie-input-group input {
            flex: 1;
            padding: 14px 16px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            color: #fff;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.2s;
        }

        .cookie-input-group input:focus {
            border-color: rgba(228, 64, 95, 0.5);
            box-shadow: 0 0 0 3px rgba(228, 64, 95, 0.1);
        }

        .cookie-input-group input::placeholder {
            color: rgba(255, 255, 255, 0.25);
        }

        .btn-auth-submit {
            padding: 14px 24px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 16px -4px rgba(16, 185, 129, 0.5);
        }

        .btn-auth-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px -4px rgba(16, 185, 129, 0.6);
        }

        .cookie-help-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: rgba(99, 102, 241, 0.8);
            font-size: 0.85rem;
            text-decoration: none;
            transition: color 0.2s;
        }

        .cookie-help-link:hover {
            color: #8b5cf6;
        }

        /* ===== Result Section Tabs ===== */
        .result-tabs {
            display: flex;
            gap: 4px;
            padding: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 14px;
            margin-bottom: 20px;
        }

        .result-tab {
            flex: 1;
            padding: 12px 16px;
            font-size: 0.85rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.5);
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .result-tab::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            opacity: 0;
            transition: opacity 0.25s;
        }

        .result-tab:hover {
            color: rgba(255, 255, 255, 0.8);
        }

        .result-tab:hover::before {
            opacity: 1;
        }

        .result-tab.active {
            color: #fff;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            box-shadow: 0 4px 12px -2px rgba(99, 102, 241, 0.4);
        }

        .result-tab.active::before {
            opacity: 0;
        }

        .result-tab svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .result-tab-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            background: rgba(16, 185, 129, 0.3);
            color: #6ee7b7;
            border-radius: 4px;
            margin-left: 4px;
        }

        .result-tab.active .result-tab-badge {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        /* Tab Panel */
        .tab-panel {
            display: none;
            animation: tabFadeIn 0.3s ease;
        }

        .tab-panel.active {
            display: block;
        }

        @keyframes tabFadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Action Card */
        .action-card {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .action-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .action-card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .action-card-icon.green {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.2));
            color: #6ee7b7;
        }

        .action-card-icon.purple {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(99, 102, 241, 0.2));
            color: #a78bfa;
        }

        .action-card-icon.blue {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.2));
            color: #60a5fa;
        }

        .action-card-icon svg {
            width: 20px;
            height: 20px;
        }

        .action-card-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #fff;
        }

        .action-card-desc {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 2px;
        }

        /* Action Button Group */
        .action-btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 16px;
            font-size: 0.85rem;
            font-weight: 500;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            color: #fff;
            box-shadow: 0 4px 12px -2px rgba(99, 102, 241, 0.4);
        }

        .action-btn.primary:hover {
            box-shadow: 0 6px 16px -2px rgba(99, 102, 241, 0.5);
        }

        .action-btn.success {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: #fff;
            box-shadow: 0 4px 12px -2px rgba(16, 185, 129, 0.4);
        }

        .action-btn.success:hover {
            box-shadow: 0 6px 16px -2px rgba(16, 185, 129, 0.5);
        }

        .action-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Content Box */
        .content-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.8;
            font-size: 0.9rem;
            max-height: 280px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .content-box::-webkit-scrollbar {
            width: 6px;
        }

        .content-box::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .content-box::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 3px;
        }

        .content-box::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Section Header */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #a78bfa;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title.green {
            color: #6ee7b7;
        }

        /* Quick Actions Bar */
        .quick-actions {
            display: flex;
            gap: 6px;
            padding: 8px;
            background: rgba(139, 92, 246, 0.08);
            border: 1px solid rgba(139, 92, 246, 0.15);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .quick-action-btn {
            padding: 8px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .quick-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .quick-action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .quick-action-btn.yellow { color: #fbbf24; }
        .quick-action-btn.blue { color: #60a5fa; }
        .quick-action-btn.purple { color: #a78bfa; }
        .quick-action-btn.green { color: #6ee7b7; }

        .quick-action-btn.yellow:hover { background: rgba(251, 191, 36, 0.15); }
        .quick-action-btn.blue:hover { background: rgba(96, 165, 250, 0.15); }
        .quick-action-btn.purple:hover { background: rgba(167, 139, 250, 0.15); }
        .quick-action-btn.green:hover { background: rgba(110, 231, 183, 0.15); }

        /* Inline Controls */
        .inline-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-select {
            padding: 10px 14px;
            font-size: 0.85rem;
            font-family: inherit;
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            outline: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .control-select:hover {
            border-color: rgba(139, 92, 246, 0.4);
        }

        .control-select:focus {
            border-color: rgba(139, 92, 246, 0.6);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .control-select option {
            background: #1a1a2e;
            color: #fff;
        }

        /* Checkbox Label */
        .checkbox-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: rgba(66, 133, 244, 0.1);
            border: 1px solid rgba(66, 133, 244, 0.25);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            color: #4285f4;
            transition: all 0.2s;
        }

        .checkbox-label:hover {
            background: rgba(66, 133, 244, 0.15);
            border-color: rgba(66, 133, 244, 0.4);
        }

        .checkbox-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #4285f4;
        }

        .checkbox-label svg {
            width: 16px;
            height: 16px;
        }

        /* Notion Save Box */
        .notion-save-box {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 14px;
            padding: 16px;
            margin-top: 16px;
        }

        .notion-save-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .notion-save-header svg {
            width: 20px;
            height: 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .notion-save-header span {
            font-size: 0.9rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
        }

        .notion-input-group {
            display: flex;
            gap: 10px;
        }

        .notion-input {
            flex: 1;
            padding: 12px 16px;
            font-size: 0.85rem;
            font-family: inherit;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            outline: none;
            transition: all 0.2s;
        }

        .notion-input:focus {
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .notion-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .notion-hint {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 8px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.4);
        }

        .empty-state-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            opacity: 0.3;
        }

        .empty-state p {
            font-size: 0.9rem;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.2s ease;
        }

        .modal-content {
            background: #12121a;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 32px;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4);
        }

        .modal-content h3 {
            margin-bottom: 24px;
            color: #fff;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-content ol {
            margin-left: 20px;
            line-height: 2;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .modal-content li {
            margin-bottom: 8px;
        }

        .modal-content strong {
            color: #8b5cf6;
        }

        @media (max-width: 600px) {
            .container {
                padding: 32px 16px;
            }

            .input-group {
                flex-direction: column;
            }

            .platforms {
                gap: 6px;
            }

            .platform-badge {
                padding: 6px 10px;
                font-size: 0.75rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .download-options {
                flex-direction: column;
            }

            .download-options button {
                width: 100%;
            }

            .auth-banner {
                padding: 20px 16px;
            }

            .auth-header {
                flex-direction: column;
                text-align: center;
            }

            .auth-tabs {
                flex-direction: column;
            }

            .cookie-input-group {
                flex-direction: column;
            }

            .btn-auth-submit {
                width: 100%;
            }

            .settings-btn {
                width: 40px;
                height: 40px;
            }
        }

        /* ===== 모드 탭 스타일 ===== */
        .mode-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: rgba(255, 255, 255, 0.02);
            padding: 6px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .mode-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .mode-tab:hover {
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.05);
        }

        .mode-tab.active {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: #fff;
            box-shadow: 0 4px 12px -2px rgba(99, 102, 241, 0.4);
        }

        .mode-tab svg {
            width: 18px;
            height: 18px;
        }

        .mode-section {
            display: none;
        }

        .mode-section.active {
            display: block;
        }

        /* 병렬 모드 스타일 */
        .batch-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 20px;
            padding: 24px;
            backdrop-filter: blur(20px);
        }

        .batch-header {
            margin-bottom: 20px;
        }

        .batch-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .batch-header p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
        }

        .batch-instructor-select {
            margin-bottom: 16px;
        }

        .batch-instructor-select label {
            display: block;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .batch-urls-input {
            width: 100%;
            min-height: 150px;
            padding: 16px;
            font-size: 0.9rem;
            font-family: inherit;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            background: rgba(0, 0, 0, 0.4);
            color: #fff;
            outline: none;
            resize: vertical;
            transition: all 0.2s;
            margin-bottom: 16px;
        }

        .batch-urls-input:focus {
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .batch-urls-input::placeholder {
            color: rgba(255, 255, 255, 0.25);
        }

        .batch-start-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
            border: none;
            border-radius: 14px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .batch-start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px -4px rgba(16, 185, 129, 0.4);
        }

        .batch-start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .batch-start-btn svg {
            width: 20px;
            height: 20px;
        }

        /* 병렬 처리 결과 */
        .batch-results {
            margin-top: 24px;
            display: none;
        }

        .batch-results.active {
            display: block;
        }

        .batch-progress {
            margin-bottom: 20px;
        }

        .batch-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .batch-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .batch-progress-text {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }

        .batch-summary {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .batch-summary-item {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            text-align: center;
        }

        .batch-summary-item .count {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .batch-summary-item .label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
        }

        .batch-summary-item.success .count { color: #10b981; }
        .batch-summary-item.failed .count { color: #ef4444; }
        .batch-summary-item.pending .count { color: #f59e0b; }

        .batch-items {
            max-height: 400px;
            overflow-y: auto;
        }

        .batch-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.04);
        }

        .batch-item-status {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .batch-item-status.pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .batch-item-status.processing {
            background: rgba(99, 102, 241, 0.2);
            color: #6366f1;
        }

        .batch-item-status.success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .batch-item-status.failed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .batch-item-status svg {
            width: 18px;
            height: 18px;
        }

        .batch-item-info {
            flex: 1;
            min-width: 0;
        }

        .batch-item-url {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .batch-item-detail {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
        }

        .batch-item-link {
            color: #8b5cf6;
            text-decoration: none;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .batch-item-link:hover {
            text-decoration: underline;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .batch-item-status.processing svg {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
            </div>
            <h1>MetaGrabber</h1>
            <p class="subtitle">Download videos from anywhere</p>
            <div class="platforms">
                <span class="platform-badge youtube">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#ff0000">
                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                    YouTube
                </span>
                <span class="platform-badge instagram">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#e4405f">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/>
                    </svg>
                    Instagram
                </span>
                <span class="platform-badge facebook">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#1877f2">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    Facebook
                </span>
                <span class="platform-badge googleads">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#4285f4">
                        <path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"/>
                    </svg>
                    Google Ads
                </span>
            </div>
        </header>

        <!-- Instagram 인증 필요 배너 (평소엔 숨김) -->
        <div class="auth-banner" id="loginBanner" style="display: none;">
            <div class="auth-header">
                <div class="auth-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="url(#insta-gradient)">
                        <defs>
                            <linearGradient id="insta-gradient" x1="0%" y1="100%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#FFDC80"/>
                                <stop offset="25%" style="stop-color:#F77737"/>
                                <stop offset="50%" style="stop-color:#E1306C"/>
                                <stop offset="75%" style="stop-color:#C13584"/>
                                <stop offset="100%" style="stop-color:#833AB4"/>
                            </linearGradient>
                        </defs>
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/>
                    </svg>
                </div>
                <div class="auth-title">
                    <h3>Instagram 인증 필요</h3>
                    <p>비디오를 다운로드하려면 로그인이 필요합니다</p>
                </div>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" id="tabLogin" onclick="showAuthTab('login')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                    자동 로그인
                </button>
                <button class="auth-tab" id="tabCookie" onclick="showAuthTab('cookie')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"/>
                    </svg>
                    쿠키 입력
                </button>
            </div>

            <div class="auth-content-wrapper">
                <!-- 자동 로그인 -->
                <div id="authLogin" class="auth-content">
                    <div class="auth-card">
                        <div class="auth-card-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="#10b981">
                                <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                            </svg>
                        </div>
                        <h4>브라우저에서 로그인</h4>
                        <p>새 창이 열리면 Instagram에 로그인하세요.<br>로그인 완료 시 자동으로 인증됩니다.</p>
                        <button class="btn-auth-action" onclick="openLoginWindow()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                            </svg>
                            Instagram 로그인 창 열기
                        </button>
                    </div>
                </div>

                <!-- 쿠키 직접 입력 -->
                <div id="authCookie" class="auth-content" style="display: none;">
                    <div class="auth-card">
                        <div class="auth-card-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="#f59e0b">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                            </svg>
                        </div>
                        <h4>sessionid 쿠키 직접 입력</h4>
                        <p>브라우저 개발자 도구에서 쿠키를 복사하세요.</p>
                        <div class="cookie-input-group">
                            <input type="text" id="sessionidInput" placeholder="sessionid 값을 붙여넣으세요">
                            <button class="btn-auth-submit" onclick="saveCookie()">저장</button>
                        </div>
                        <a href="#" class="cookie-help-link" onclick="showCookieHelp(); return false;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>
                            </svg>
                            쿠키 찾는 방법
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- OpenAI API 키 설정 모달 -->
        <div class="modal" id="openaiKeyModal" style="display: none;">
            <div class="modal-content" style="max-width: 480px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h3 style="margin: 0;">OpenAI Whisper API 설정</h3>
                    <button onclick="closeOpenAIModal()" style="background: none; border: none; color: rgba(255,255,255,0.5); font-size: 24px; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
                </div>

                <!-- 비밀번호 입력 (인증 전) -->
                <div id="apiKeyAuthSection">
                    <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-bottom: 16px; text-align: center;">
                        관리자 비밀번호를 입력하세요
                    </p>
                    <div class="cookie-input-group" style="margin-bottom: 12px;">
                        <input type="password" id="apiKeyPassword" placeholder="비밀번호" style="flex: 1; text-align: center;" onkeypress="if(event.key==='Enter')checkAPIKeyPassword()">
                        <button class="btn-auth-submit" onclick="checkAPIKeyPassword()" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">확인</button>
                    </div>
                    <p id="apiKeyAuthError" style="color: #f87171; font-size: 0.85rem; text-align: center; display: none;"></p>
                </div>

                <!-- API 키 관리 (인증 후) -->
                <div id="apiKeyManageSection" style="display: none;">
                    <p style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 16px; line-height: 1.6;">
                        여러 API 키를 등록하면 자동으로 로드밸런싱됩니다.
                    </p>

                    <!-- 등록된 키 목록 -->
                    <div id="apiKeyList" style="margin-bottom: 16px; max-height: 200px; overflow-y: auto;"></div>

                    <!-- 새 키 추가 -->
                    <div class="cookie-input-group" style="margin-bottom: 16px;">
                        <input type="password" id="openaiKeyInput" placeholder="sk-proj-... API 키 입력" style="border-color: rgba(139, 92, 246, 0.3); flex: 1;">
                        <button class="btn-auth-submit" onclick="addOpenAIKey()" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">추가</button>
                    </div>

                    <p style="font-size: 0.8rem; color: rgba(255,255,255,0.4); text-align: center;">
                        <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #8b5cf6;">platform.openai.com</a>에서 API 키 발급
                    </p>
                </div>
            </div>
        </div>

        <!-- 교정 전/후 비교 모달 -->
        <div class="modal" id="diffModal" style="display: none;">
            <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow: hidden; display: flex; flex-direction: column;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="margin: 0;">교정 내용</h3>
                    <button onclick="closeDiffModal()" style="background: none; border: none; color: rgba(255,255,255,0.5); font-size: 24px; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
                </div>
                <div style="display: flex; gap: 12px; margin-bottom: 16px; font-size: 0.8rem;">
                    <span><span style="color: #f87171; text-decoration: line-through;">삭제</span></span>
                    <span><span style="color: #6ee7b7;">추가</span></span>
                </div>
                <div id="diffContent" style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; font-size: 0.9rem; line-height: 2; color: rgba(255,255,255,0.9); overflow-y: auto; max-height: 500px;"></div>
            </div>
        </div>

        <!-- 쿠키 도움말 모달 -->
        <div class="modal" id="cookieHelpModal" style="display: none;">
            <div class="modal-content">
                <h3>Instagram sessionid 쿠키 찾는 방법</h3>
                <ol>
                    <li>브라우저에서 <a href="https://www.instagram.com" target="_blank" style="color: #00d4ff;">Instagram</a>에 로그인</li>
                    <li>F12 눌러서 개발자 도구 열기</li>
                    <li><strong>Application</strong> 탭 클릭 (Chrome) 또는 <strong>Storage</strong> 탭 (Firefox)</li>
                    <li>왼쪽에서 <strong>Cookies → https://www.instagram.com</strong> 선택</li>
                    <li><strong>sessionid</strong> 찾아서 Value 복사</li>
                </ol>
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'%3E%3Crect fill='%231a1a2e' width='400' height='200'/%3E%3Ctext x='200' y='100' text-anchor='middle' fill='%238892b0' font-size='14'%3EApplication → Cookies → sessionid%3C/text%3E%3C/svg%3E" style="width: 100%; border-radius: 8px; margin: 15px 0;">
                <button class="btn-primary" onclick="closeCookieHelp()" style="width: 100%;">닫기</button>
            </div>
        </div>

        <!-- 모드 선택 탭 -->
        <div class="mode-tabs">
            <button class="mode-tab active" onclick="switchMode('single')" data-mode="single">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                단일 모드
            </button>
            <button class="mode-tab" onclick="switchMode('batch')" data-mode="batch">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg>
                병렬 모드
            </button>
        </div>

        <!-- 단일 모드 섹션 -->
        <div class="mode-section active" id="singleModeSection">
            <section class="input-section">
                <div class="input-group">
                    <input type="text" id="urlInput" placeholder="영상 URL을 붙여넣으세요">
                    <button class="btn-primary" id="extractBtn" onclick="extractVideo()">추출하기</button>
                </div>
                <div class="error-message" id="errorMsg"></div>
                <div class="success-message" id="successMsg"></div>
            </section>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>비디오 정보를 추출하는 중... (최대 30초 소요)</p>
            </div>

        <section class="result-section" id="resultSection">
            <!-- 탭 네비게이션 -->
            <div class="result-tabs">
                <button class="result-tab active" onclick="switchResultTab('media')" data-tab="media">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg>
                    미디어
                </button>
                <button class="result-tab" onclick="switchResultTab('transcribe')" data-tab="transcribe">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.42 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                    전사
                    <span class="result-tab-badge" id="transcribeBadge" style="display: none;">완료</span>
                </button>
                <button class="result-tab" onclick="switchResultTab('script')" data-tab="script">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                    스크립트
                    <span class="result-tab-badge" id="scriptBadge" style="display: none;">완료</span>
                </button>
            </div>

            <!-- 탭 1: 미디어 -->
            <div class="tab-panel active" id="tabPanelMedia">
                <div class="video-preview">
                    <video id="videoPreview" controls></video>
                </div>
                <div class="video-info">
                    <h3 class="video-title" id="videoTitle"></h3>
                    <span class="video-platform" id="videoPlatform"></span>
                </div>
                <div class="action-btn-group">
                    <button class="action-btn success" onclick="downloadVideo()">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                        다운로드
                    </button>
                    <button class="action-btn" onclick="copyUrl()">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                        URL 복사
                    </button>
                </div>
            </div>

            <!-- 탭 2: 전사 -->
            <div class="tab-panel" id="tabPanelTranscribe">
                <!-- 전사 컨트롤 -->
                <div class="action-card">
                    <div class="action-card-header">
                        <div class="action-card-icon purple">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.42 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                        </div>
                        <div>
                            <div class="action-card-title">음성 전사</div>
                            <div class="action-card-desc">영상의 음성을 텍스트로 변환합니다</div>
                        </div>
                    </div>
                    <div class="inline-controls">
                        <select id="transcribeLang" class="control-select">
                            <option value="">자동 감지</option>
                            <option value="ko">한국어</option>
                            <option value="en">English</option>
                            <option value="ja">日本語</option>
                            <option value="zh">中文</option>
                            <option value="es">Español</option>
                        </select>
                        <button class="action-btn primary" id="btnTranscribe" onclick="transcribeVideo()">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.42 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                            전사 시작
                        </button>
                    </div>
                </div>

                <!-- 전사 결과 -->
                <div id="transcribeSection" style="display: none;">
                    <div class="section-header">
                        <div class="section-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                            전사 결과
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-action-btn yellow" id="btnSummarize" onclick="summarizeTranscript()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M14 17H4v2h10v-2zm6-8H4v2h16V9zM4 15h16v-2H4v2zM4 5v2h16V5H4z"/></svg>
                            요약
                        </button>
                        <button class="quick-action-btn blue" id="btnTranslate" onclick="translateTranscript()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>
                            번역
                        </button>
                        <button class="quick-action-btn purple" id="btnCorrect" onclick="correctTranscript()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                            GPT 교정
                        </button>
                        <button class="quick-action-btn" onclick="copyTranscript()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            복사
                        </button>
                    </div>
                    <div class="content-box" id="transcribeContent"></div>
                </div>

                <!-- 빈 상태 -->
                <div id="transcribeEmpty" class="empty-state">
                    <svg class="empty-state-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.42 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                    <p>위에서 전사 시작 버튼을 눌러주세요</p>
                </div>
            </div>

            <!-- 탭 3: 스크립트 -->
            <div class="tab-panel" id="tabPanelScript">
                <!-- 스크립트 생성 컨트롤 -->
                <div class="action-card">
                    <div class="action-card-header">
                        <div class="action-card-icon green">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/></svg>
                        </div>
                        <div>
                            <div class="action-card-title">스크립트 생성</div>
                            <div class="action-card-desc">강사별 맞춤 스크립트를 생성합니다</div>
                        </div>
                    </div>
                    <div class="inline-controls">
                        <select id="instructorSelect" class="control-select" onchange="onInstructorChange()">
                            <option value="">강사 선택...</option>
                        </select>
                        <label id="googleDriveLabel" class="checkbox-label" style="display: none;">
                            <input type="checkbox" id="uploadToGoogleDrive" checked>
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7.71 3.5L1.15 15l4.58 7.5h13.54l4.58-7.5L17.29 3.5H7.71zm-.29 1h9.16l5.48 10H2.94l5.48-10zm4.58 2L6.52 15h10.96L12 6.5z"/></svg>
                            Drive 저장
                        </label>
                        <button class="action-btn success" id="btnGenerateScript" onclick="generateScript()">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/></svg>
                            생성
                        </button>
                        <button class="action-btn" onclick="showScriptSettings()">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                            설정
                        </button>
                    </div>
                </div>

                <!-- 생성된 스크립트 결과 -->
                <div id="generatedScriptSection" style="display: none;">
                    <div class="section-header">
                        <div class="section-title green">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                            <span id="generatedInstructorName"></span> 버전 스크립트
                        </div>
                        <button class="action-btn" onclick="copyGeneratedScript()" style="padding: 6px 12px;">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            복사
                        </button>
                    </div>
                    <div class="content-box" id="generatedScriptContent" style="background: rgba(16,185,129,0.08); border: 1px solid rgba(16,185,129,0.15);"></div>

                    <!-- Notion 저장 -->
                    <div id="notionSaveSection" class="notion-save-box" style="display: none;">
                        <div class="notion-save-header">
                            <svg viewBox="0 0 100 100" fill="currentColor"><path d="M6.017 4.313l55.333 -4.087c6.797 -0.583 8.543 -0.19 12.817 2.917l17.663 12.443c2.913 2.14 3.883 2.723 3.883 5.053v68.243c0 4.277 -1.553 6.807 -6.99 7.193l-64.25 3.888c-4.083 0.193 -6.023 -0.39 -8.16 -3.113l-12.433 -16.136c-2.333 -3.107 -3.307 -5.443 -3.307 -8.167v-65.607c0 -3.497 1.553 -6.413 5.443 -6.627z"/></svg>
                            <span>Notion에 저장</span>
                        </div>
                        <div class="notion-input-group">
                            <input type="text" id="notionDbUrl" class="notion-input" placeholder="Notion 데이터베이스 URL 붙여넣기">
                            <button class="action-btn primary" id="btnSaveNotionNew" onclick="saveToNotionWithUrl()">저장</button>
                        </div>
                        <p class="notion-hint">예: https://www.notion.so/workspace/데이터베이스ID?v=...</p>
                    </div>
                </div>

                <!-- 빈 상태 -->
                <div id="scriptEmpty" class="empty-state">
                    <svg class="empty-state-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                    <p>먼저 전사를 완료한 후 강사를 선택하세요</p>
                </div>
            </div>
        </section>
        </div><!-- 단일 모드 섹션 끝 -->

        <!-- 병렬 모드 섹션 -->
        <div class="mode-section" id="batchModeSection">
            <div class="batch-section">
                <div class="batch-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <h3>병렬 처리 모드</h3>
                        <p>여러 URL을 한 번에 처리하여 스크립트 생성 및 노션 저장까지 자동으로 완료합니다.</p>
                    </div>
                    <button class="action-btn" onclick="showScriptSettings()" style="flex-shrink: 0;">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                        설정
                    </button>
                </div>

                <div class="batch-instructor-select">
                    <label for="batchInstructorSelect">강사 선택</label>
                    <select id="batchInstructorSelect" class="control-select" style="width: 100%;">
                        <option value="">강사를 선택하세요...</option>
                    </select>
                </div>

                <textarea
                    id="batchUrlsInput"
                    class="batch-urls-input"
                    placeholder="URL을 한 줄에 하나씩 입력하세요&#10;&#10;예시:&#10;https://www.facebook.com/ads/library/?id=123456789&#10;https://www.instagram.com/reel/ABC123&#10;https://www.youtube.com/watch?v=xyz"
                ></textarea>

                <button class="batch-start-btn" id="batchStartBtn" onclick="startBatchProcess()">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                    일괄 처리 시작
                </button>

                <div class="batch-results" id="batchResults">
                    <div class="batch-progress">
                        <div class="batch-progress-bar">
                            <div class="batch-progress-fill" id="batchProgressFill"></div>
                        </div>
                        <div class="batch-progress-text" id="batchProgressText">0 / 0 처리 중...</div>
                    </div>

                    <div class="batch-summary" id="batchSummary" style="display: none;">
                        <div class="batch-summary-item success">
                            <div class="count" id="batchSuccessCount">0</div>
                            <div class="label">성공</div>
                        </div>
                        <div class="batch-summary-item failed">
                            <div class="count" id="batchFailedCount">0</div>
                            <div class="label">실패</div>
                        </div>
                        <div class="batch-summary-item pending">
                            <div class="count" id="batchPendingCount">0</div>
                            <div class="label">대기</div>
                        </div>
                    </div>

                    <div class="batch-items" id="batchItems"></div>
                </div>
            </div>
        </div><!-- 병렬 모드 섹션 끝 -->

        <!-- 스크립트 설정 모달 -->
        <div class="modal" id="scriptSettingsModal" style="display: none;">
            <div class="modal-content" style="max-width: 600px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">스크립트 생성 설정</h3>
                    <button onclick="closeScriptSettings()" style="background: none; border: none; color: rgba(255,255,255,0.5); font-size: 24px; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
                </div>

                <!-- 탭 -->
                <div style="display: flex; gap: 6px; margin-bottom: 20px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 12px;">
                    <button class="script-settings-tab active" id="tabPrompt" onclick="showScriptSettingsTab('prompt')" style="flex: 1; padding: 10px; border: none; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #fff; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">지침 설정</button>
                    <button class="script-settings-tab" id="tabInstructors" onclick="showScriptSettingsTab('instructors')" style="flex: 1; padding: 10px; border: none; background: transparent; color: rgba(255,255,255,0.5); border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">강사 관리</button>
                </div>

                <!-- 지침 설정 탭 -->
                <div id="promptSettingsContent" style="flex: 1; overflow-y: auto;">
                    <p style="color: rgba(255,255,255,0.5); font-size: 0.85rem; margin-bottom: 12px;">GPT에게 전달할 시스템 지침을 입력하세요. 강사 정보는 자동으로 추가됩니다.</p>
                    <textarea id="promptTextarea" placeholder="예: 우리는 강사의 광고 소재를 기획하는 회사야. 너는 강사 정보를 참고해서 우리가 제공하는 스크립트를 강사의 정보로 치환해서 새로운 소재처럼 만들어줘." style="width: 100%; height: 200px; padding: 16px; font-size: 0.9rem; font-family: inherit; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; background: rgba(0,0,0,0.3); color: #fff; outline: none; resize: vertical; line-height: 1.6;"></textarea>
                    <button onclick="savePrompt()" style="margin-top: 12px; padding: 12px 24px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #fff; border: none; border-radius: 10px; font-size: 0.9rem; font-weight: 600; cursor: pointer;">지침 저장</button>
                </div>

                <!-- 강사 관리 탭 -->
                <div id="instructorsSettingsContent" style="display: none; flex: 1; overflow-y: auto;">
                    <div style="margin-bottom: 16px;">
                        <input type="text" id="newInstructorName" placeholder="강사 이름" style="width: 100%; padding: 12px 16px; font-size: 0.9rem; font-family: inherit; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; background: rgba(0,0,0,0.3); color: #fff; outline: none; margin-bottom: 8px;">
                        <textarea id="newInstructorInfo" placeholder="강사 정보 (경력, 전문분야, 특징 등)" style="width: 100%; height: 80px; padding: 12px 16px; font-size: 0.9rem; font-family: inherit; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; background: rgba(0,0,0,0.3); color: #fff; outline: none; resize: vertical; margin-bottom: 8px;"></textarea>
                        <button onclick="addInstructor()" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #059669); color: #fff; border: none; border-radius: 8px; font-size: 0.85rem; font-weight: 600; cursor: pointer;">강사 추가</button>
                    </div>
                    <div id="instructorsList" style="max-height: 250px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>

        <footer>
            <button class="settings-btn" onclick="showOpenAIKeyBanner()" title="API 키 설정">
                <span>&#9881;</span> OPENAI WHISPER API
            </button>
            <p>Powered by Node.js, Express, Puppeteer, yt-dlp, FFmpeg, Supabase, Docker & OpenAI Whisper</p>
        </footer>
    </div>

    <script>
        let currentVideoData = null;
        let lastFailedUrl = null;
        let transcribeAvailable = false;
        let notionAvailable = false;
        let currentTranscript = '';
        let currentCorrectedText = '';
        let currentSummary = '';
        let currentTranslatedText = '';

        // ===== 모드 전환 함수 =====
        function switchMode(mode) {
            // 탭 버튼 업데이트
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.mode-tab[data-mode="${mode}"]`).classList.add('active');

            // 섹션 업데이트
            document.querySelectorAll('.mode-section').forEach(section => {
                section.classList.remove('active');
            });

            if (mode === 'single') {
                document.getElementById('singleModeSection').classList.add('active');
            } else if (mode === 'batch') {
                document.getElementById('batchModeSection').classList.add('active');
                // 병렬 모드 강사 목록 업데이트
                updateBatchInstructorSelect();
            }
        }

        // 병렬 모드 강사 선택 드롭다운 업데이트
        async function updateBatchInstructorSelect() {
            const select = document.getElementById('batchInstructorSelect');

            // 강사 목록이 비어있으면 먼저 로드
            if (instructorsList.length === 0) {
                select.innerHTML = '<option value="">강사 목록 로딩 중...</option>';
                await loadInstructors();
            }

            select.innerHTML = '<option value="">강사를 선택하세요...</option>';
            instructorsList.forEach(inst => {
                select.innerHTML += `<option value="${inst.id}" style="color: #333; background: #fff;">${inst.name}</option>`;
            });
        }

        // ===== 병렬 처리 함수 =====
        let batchProcessing = false;

        async function startBatchProcess() {
            if (batchProcessing) return;

            const instructorId = document.getElementById('batchInstructorSelect').value;
            const urlsText = document.getElementById('batchUrlsInput').value.trim();

            if (!instructorId) {
                alert('강사를 선택해주세요.');
                return;
            }

            if (!urlsText) {
                alert('처리할 URL을 입력해주세요.');
                return;
            }

            // URL 목록 파싱 (빈 줄 제거)
            const urls = urlsText.split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);

            if (urls.length === 0) {
                alert('유효한 URL이 없습니다.');
                return;
            }

            batchProcessing = true;
            const startBtn = document.getElementById('batchStartBtn');
            startBtn.disabled = true;
            startBtn.innerHTML = `
                <svg viewBox="0 0 24 24" fill="currentColor" style="animation: spin 1s linear infinite;">
                    <path d="M12 4V2A10 10 0 0 0 2 12h2a8 8 0 0 1 8-8z"/>
                </svg>
                처리 중...
            `;

            // 결과 영역 표시
            const resultsDiv = document.getElementById('batchResults');
            resultsDiv.classList.add('active');

            // 초기 아이템 렌더링
            renderBatchItems(urls.map(url => ({ url, status: 'pending' })));

            // 진행 상황 초기화
            updateBatchProgress(0, urls.length);
            document.getElementById('batchSummary').style.display = 'none';

            try {
                const response = await fetch('/api/batch-process', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ urls, instructorId })
                });

                const data = await response.json();

                if (data.success) {
                    // 결과 렌더링
                    renderBatchItems(data.results);
                    updateBatchProgress(urls.length, urls.length);

                    // 요약 표시
                    document.getElementById('batchSummary').style.display = 'flex';
                    document.getElementById('batchSuccessCount').textContent = data.summary.success;
                    document.getElementById('batchFailedCount').textContent = data.summary.failed;
                    document.getElementById('batchPendingCount').textContent = data.summary.skipped;

                    document.getElementById('batchProgressText').textContent =
                        `완료! 성공: ${data.summary.success}, 실패: ${data.summary.failed}`;
                } else {
                    alert('처리 중 오류가 발생했습니다: ' + (data.error || '알 수 없는 오류'));
                }
            } catch (error) {
                alert('서버 통신 오류: ' + error.message);
            } finally {
                batchProcessing = false;
                startBtn.disabled = false;
                startBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                    일괄 처리 시작
                `;
            }
        }

        function updateBatchProgress(current, total) {
            const percent = total > 0 ? (current / total) * 100 : 0;
            document.getElementById('batchProgressFill').style.width = percent + '%';
            document.getElementById('batchProgressText').textContent = `${current} / ${total} 처리 중...`;
        }

        function renderBatchItems(items) {
            const container = document.getElementById('batchItems');
            container.innerHTML = '';

            items.forEach((item, index) => {
                const statusIcon = getBatchStatusIcon(item.status);
                const statusClass = item.status;

                let detailText = '';
                if (item.status === 'success') {
                    detailText = item.platform ? `${item.platform} | ${item.title || ''}` : '';
                } else if (item.status === 'failed') {
                    detailText = item.error || '처리 실패';
                } else if (item.status === 'pending') {
                    detailText = '대기 중';
                } else if (item.status === 'skipped') {
                    detailText = item.error || '건너뜀';
                }

                const notionLink = item.notionUrl
                    ? `<a href="${item.notionUrl}" target="_blank" class="batch-item-link">Notion 열기</a>`
                    : '';

                container.innerHTML += `
                    <div class="batch-item">
                        <div class="batch-item-status ${statusClass}">
                            ${statusIcon}
                        </div>
                        <div class="batch-item-info">
                            <div class="batch-item-url">${truncateUrl(item.url)}</div>
                            <div class="batch-item-detail">${detailText}</div>
                        </div>
                        ${notionLink}
                    </div>
                `;
            });
        }

        function getBatchStatusIcon(status) {
            switch (status) {
                case 'pending':
                    return '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>';
                case 'processing':
                    return '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 4V2A10 10 0 0 0 2 12h2a8 8 0 0 1 8-8z"/></svg>';
                case 'success':
                    return '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
                case 'failed':
                case 'skipped':
                    return '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>';
                default:
                    return '';
            }
        }

        function truncateUrl(url) {
            if (!url) return '';
            if (url.length <= 60) return url;
            return url.substring(0, 30) + '...' + url.substring(url.length - 25);
        }

        // 탭 전환 함수
        function switchResultTab(tabName) {
            // 모든 탭 버튼에서 active 제거
            document.querySelectorAll('.result-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            // 클릭한 탭 버튼에 active 추가
            document.querySelector(`.result-tab[data-tab="${tabName}"]`).classList.add('active');

            // 모든 탭 패널 숨기기
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            // 선택한 탭 패널 표시
            const panelId = 'tabPanel' + tabName.charAt(0).toUpperCase() + tabName.slice(1);
            document.getElementById(panelId).classList.add('active');
        }

        // 전사 완료 시 뱃지 표시 및 빈 상태 숨기기
        function updateTranscribeUI(hasContent) {
            const badge = document.getElementById('transcribeBadge');
            const emptyState = document.getElementById('transcribeEmpty');
            const section = document.getElementById('transcribeSection');

            if (hasContent) {
                if (badge) badge.style.display = 'inline';
                if (emptyState) emptyState.style.display = 'none';
                if (section) section.style.display = 'block';
            } else {
                if (badge) badge.style.display = 'none';
                if (emptyState) emptyState.style.display = 'block';
                if (section) section.style.display = 'none';
            }
        }

        // 스크립트 생성 완료 시 뱃지 표시 및 빈 상태 숨기기
        function updateScriptUI(hasContent) {
            const badge = document.getElementById('scriptBadge');
            const emptyState = document.getElementById('scriptEmpty');
            const section = document.getElementById('generatedScriptSection');

            if (hasContent) {
                if (badge) badge.style.display = 'inline';
                if (emptyState) emptyState.style.display = 'none';
                if (section) section.style.display = 'block';
            } else {
                if (badge) badge.style.display = 'none';
                if (emptyState) emptyState.style.display = 'block';
                if (section) section.style.display = 'none';
            }
        }

        // 페이지 로드 시 전사 기능 상태 확인
        async function checkTranscribeStatus() {
            try {
                const response = await fetch('/api/transcribe/status');
                const data = await response.json();
                transcribeAvailable = data.available;

                // 전사 버튼 표시/숨김
                const btnTranscribe = document.getElementById('btnTranscribe');
                if (btnTranscribe) {
                    btnTranscribe.style.display = transcribeAvailable ? 'flex' : 'none';
                }
            } catch (error) {
                console.error('전사 상태 확인 실패:', error);
            }
        }

        // Google Drive 상태 확인
        async function checkGoogleDriveStatus() {
            try {
                const response = await fetch('/api/google/status');
                const data = await response.json();

                // Google Drive 체크박스 표시/숨김
                const googleDriveLabel = document.getElementById('googleDriveLabel');
                if (googleDriveLabel) {
                    if (data.enabled && data.authenticated) {
                        googleDriveLabel.style.display = 'flex';
                    } else {
                        googleDriveLabel.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Google Drive 상태 확인 실패:', error);
            }
        }

        // Notion 상태 확인
        async function checkNotionStatus() {
            try {
                const response = await fetch('/api/notion/status');
                const data = await response.json();
                notionAvailable = data.enabled;

                // Notion 버튼 표시/숨김
                const btnSaveNotion = document.getElementById('btnSaveNotion');
                if (btnSaveNotion) {
                    btnSaveNotion.style.display = notionAvailable ? 'inline-flex' : 'none';
                }
            } catch (error) {
                console.error('Notion 상태 확인 실패:', error);
            }
        }

        // ===== 강사 및 스크립트 생성 기능 =====
        let instructorsList = [];
        let generatedScript = '';

        // 강사 목록 로드
        async function loadInstructors() {
            try {
                const response = await fetch('/api/instructors');
                const data = await response.json();
                if (data.success) {
                    instructorsList = data.instructors;
                    renderInstructorSelect(false);
                    renderInstructorsList();
                    // 저장된 강사 선택 로드
                    await loadSelectedInstructor();
                }
            } catch (error) {
                console.error('강사 목록 로드 실패:', error);
            }
        }

        // 강사 선택 드롭다운 렌더링
        function renderInstructorSelect(preserveSelection = true) {
            const select = document.getElementById('instructorSelect');
            const currentValue = preserveSelection ? select.value : '';

            select.innerHTML = '<option value="" style="color: #333; background: #fff;">강사 선택...</option>';
            instructorsList.forEach(inst => {
                select.innerHTML += `<option value="${inst.id}" style="color: #333; background: #fff;">${inst.name}</option>`;
            });

            // 이전 선택 복원
            if (currentValue) {
                select.value = currentValue;
            }
        }

        // 강사 선택 변경 시 저장
        async function onInstructorChange() {
            const select = document.getElementById('instructorSelect');
            try {
                await fetch('/api/selected-instructor', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ instructorId: select.value })
                });
            } catch (error) {
                console.error('강사 선택 저장 실패:', error);
            }
        }

        // 저장된 강사 선택 로드
        async function loadSelectedInstructor() {
            try {
                const response = await fetch('/api/selected-instructor');
                const data = await response.json();
                if (data.success && data.instructorId) {
                    document.getElementById('instructorSelect').value = data.instructorId;
                }
            } catch (error) {
                console.error('선택된 강사 로드 실패:', error);
            }
        }

        // 강사 목록 렌더링 (설정 모달)
        function renderInstructorsList() {
            const container = document.getElementById('instructorsList');
            if (instructorsList.length === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.4); text-align: center; padding: 20px;">등록된 강사가 없습니다.</p>';
                return;
            }

            let html = '';
            instructorsList.forEach(inst => {
                html += `
                <div id="instructor-${inst.id}" style="background: rgba(0,0,0,0.2); border-radius: 10px; padding: 14px; margin-bottom: 10px;">
                    <div class="instructor-view-${inst.id}">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <strong style="color: #6ee7b7; font-size: 0.95rem;">${escapeHtml(inst.name)}</strong>
                            <div style="display: flex; gap: 6px;">
                                <button onclick="showEditInstructor('${inst.id}')" style="background: rgba(99,102,241,0.2); border: none; color: #a78bfa; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer;">수정</button>
                                <button onclick="deleteInstructor('${inst.id}')" style="background: rgba(239,68,68,0.2); border: none; color: #f87171; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer;">삭제</button>
                            </div>
                        </div>
                        <p style="color: rgba(255,255,255,0.6); font-size: 0.8rem; line-height: 1.5; margin: 0;">${escapeHtml(inst.info)}</p>
                    </div>
                    <div class="instructor-edit-${inst.id}" style="display: none;">
                        <input type="text" id="edit-name-${inst.id}" value="${escapeHtml(inst.name)}" style="width: 100%; padding: 10px 12px; font-size: 0.85rem; font-family: inherit; border: 1px solid rgba(99,102,241,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: #fff; outline: none; margin-bottom: 8px;">
                        <textarea id="edit-info-${inst.id}" style="width: 100%; height: 60px; padding: 10px 12px; font-size: 0.85rem; font-family: inherit; border: 1px solid rgba(99,102,241,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: #fff; outline: none; resize: vertical; margin-bottom: 8px;">${escapeHtml(inst.info)}</textarea>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="updateInstructor('${inst.id}')" style="padding: 8px 16px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #fff; border: none; border-radius: 6px; font-size: 0.8rem; font-weight: 600; cursor: pointer;">저장</button>
                            <button onclick="cancelEditInstructor('${inst.id}')" style="padding: 8px 16px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7); border: none; border-radius: 6px; font-size: 0.8rem; cursor: pointer;">취소</button>
                        </div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        // 강사 수정 모드 표시
        function showEditInstructor(id) {
            document.querySelector(`.instructor-view-${id}`).style.display = 'none';
            document.querySelector(`.instructor-edit-${id}`).style.display = 'block';
        }

        // 강사 수정 취소
        function cancelEditInstructor(id) {
            document.querySelector(`.instructor-view-${id}`).style.display = 'block';
            document.querySelector(`.instructor-edit-${id}`).style.display = 'none';
            // 원래 값으로 복원
            const inst = instructorsList.find(i => i.id === id);
            if (inst) {
                document.getElementById(`edit-name-${id}`).value = inst.name;
                document.getElementById(`edit-info-${id}`).value = inst.info;
            }
        }

        // 강사 수정 저장
        async function updateInstructor(id) {
            const name = document.getElementById(`edit-name-${id}`).value.trim();
            const info = document.getElementById(`edit-info-${id}`).value.trim();

            if (!name || !info) {
                alert('강사 이름과 정보를 모두 입력해주세요.');
                return;
            }

            try {
                const response = await fetch(`/api/instructors/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, info })
                });
                const data = await response.json();
                if (data.success) {
                    alert('강사 정보가 수정되었습니다!');
                    loadInstructors();
                } else {
                    alert(data.error || '강사 수정 실패');
                }
            } catch (error) {
                alert('강사 수정 중 오류가 발생했습니다.');
            }
        }

        // 강사 추가
        async function addInstructor() {
            const name = document.getElementById('newInstructorName').value.trim();
            const info = document.getElementById('newInstructorInfo').value.trim();

            if (!name || !info) {
                showError('강사 이름과 정보를 모두 입력해주세요.');
                return;
            }

            try {
                const response = await fetch('/api/instructors', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, info })
                });
                const data = await response.json();
                if (data.success) {
                    document.getElementById('newInstructorName').value = '';
                    document.getElementById('newInstructorInfo').value = '';
                    showSuccess('강사가 추가되었습니다.');
                    loadInstructors();
                } else {
                    showError(data.error || '강사 추가 실패');
                }
            } catch (error) {
                showError('강사 추가 중 오류가 발생했습니다.');
            }
        }

        // 강사 삭제
        async function deleteInstructor(id) {
            if (!confirm('이 강사를 삭제하시겠습니까?')) return;

            try {
                const response = await fetch(`/api/instructors/${id}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                if (data.success) {
                    showSuccess('강사가 삭제되었습니다.');
                    loadInstructors();
                } else {
                    showError(data.error || '강사 삭제 실패');
                }
            } catch (error) {
                showError('강사 삭제 중 오류가 발생했습니다.');
            }
        }

        // 지침 로드
        async function loadPrompt() {
            try {
                const response = await fetch('/api/prompt');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('promptTextarea').value = data.prompt || '';
                }
            } catch (error) {
                console.error('지침 로드 실패:', error);
            }
        }

        // 지침 저장
        async function savePrompt() {
            const prompt = document.getElementById('promptTextarea').value.trim();
            if (!prompt) {
                alert('지침을 입력해주세요.');
                return;
            }

            try {
                const response = await fetch('/api/prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });
                const data = await response.json();
                if (data.success) {
                    alert('지침이 저장되었습니다!');
                } else {
                    alert(data.error || '지침 저장 실패');
                }
            } catch (error) {
                alert('지침 저장 중 오류가 발생했습니다.');
            }
        }

        // 스크립트 생성
        async function generateScript() {
            const instructorId = document.getElementById('instructorSelect').value;

            if (!currentTranscript) {
                showError('먼저 음성 전사를 실행해주세요.');
                return;
            }

            if (!instructorId) {
                showError('강사를 선택해주세요.');
                return;
            }

            // 선택된 강사 정보
            const instructor = instructorsList.find(i => i.id === instructorId);
            const instructorName = instructor ? instructor.name : null;

            const btn = document.getElementById('btnGenerateScript');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="spinner" style="width:16px;height:16px;border-width:2px;margin:0;"></div> 생성 중...';
            btn.disabled = true;

            try {
                const response = await fetch('/api/generate-script', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        transcript: currentTranscript,
                        instructorId: instructorId
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    generatedScript = data.script;
                    document.getElementById('generatedInstructorName').textContent = data.instructor;
                    document.getElementById('generatedScriptContent').textContent = data.script;
                    document.getElementById('notionSaveSection').style.display = 'block';
                    updateScriptUI(true);

                    // Google Drive 업로드 (체크박스 활성화 시)
                    const uploadToGoogleDrive = document.getElementById('uploadToGoogleDrive')?.checked || false;
                    if (uploadToGoogleDrive && currentVideoData?.video_url) {
                        btn.innerHTML = '<div class="spinner" style="width:16px;height:16px;border-width:2px;margin:0;"></div> Drive 업로드 중...';

                        try {
                            const uploadResponse = await fetch('/api/google/upload-from-url', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    videoUrl: currentVideoData.video_url,
                                    videoTitle: currentVideoData.title || 'video',
                                    instructorName: instructorName
                                })
                            });

                            const uploadData = await uploadResponse.json();
                            if (uploadResponse.ok && uploadData.success) {
                                currentVideoData.googleDriveUrl = uploadData.directUrl;
                                showSuccess(`${data.instructor} 스크립트 생성 완료! Google Drive 업로드됨`);
                            } else {
                                showSuccess(`${data.instructor} 스크립트 생성 완료! (Drive 업로드 실패: ${uploadData.error})`);
                            }
                        } catch (uploadError) {
                            console.error('Google Drive 업로드 에러:', uploadError);
                            showSuccess(`${data.instructor} 스크립트 생성 완료! (Drive 업로드 실패)`);
                        }
                    } else {
                        showSuccess(`${data.instructor} 버전 스크립트가 생성되었습니다.`);
                    }
                } else {
                    showError(data.error || '스크립트 생성 실패');
                }
            } catch (error) {
                showError('스크립트 생성 중 오류가 발생했습니다.');
                console.error(error);
            } finally {
                btn.innerHTML = originalHTML;
                btn.disabled = false;
            }
        }

        // 생성된 스크립트 복사
        async function copyGeneratedScript() {
            if (!generatedScript) return;
            try {
                await navigator.clipboard.writeText(generatedScript);
                showSuccess('스크립트가 복사되었습니다.');
            } catch (error) {
                // 폴백
                const textarea = document.createElement('textarea');
                textarea.value = generatedScript;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showSuccess('스크립트가 복사되었습니다.');
            }
        }

        // 설정 모달 표시
        function showScriptSettings() {
            loadPrompt();
            loadInstructors();
            document.getElementById('scriptSettingsModal').style.display = 'flex';
        }

        // 설정 모달 닫기
        function closeScriptSettings() {
            document.getElementById('scriptSettingsModal').style.display = 'none';
        }

        // 설정 탭 전환
        function showScriptSettingsTab(tab) {
            const tabPrompt = document.getElementById('tabPrompt');
            const tabInstructors = document.getElementById('tabInstructors');
            const promptContent = document.getElementById('promptSettingsContent');
            const instructorsContent = document.getElementById('instructorsSettingsContent');

            if (tab === 'prompt') {
                tabPrompt.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                tabPrompt.style.color = '#fff';
                tabInstructors.style.background = 'transparent';
                tabInstructors.style.color = 'rgba(255,255,255,0.5)';
                promptContent.style.display = 'block';
                instructorsContent.style.display = 'none';
            } else {
                tabInstructors.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                tabInstructors.style.color = '#fff';
                tabPrompt.style.background = 'transparent';
                tabPrompt.style.color = 'rgba(255,255,255,0.5)';
                promptContent.style.display = 'none';
                instructorsContent.style.display = 'block';
            }
        }

        // Notion URL에서 데이터베이스 ID 추출
        function extractNotionDatabaseId(url) {
            try {
                // URL 형식: https://www.notion.so/workspace/DATABASE_ID?v=...
                // 또는: https://www.notion.so/DATABASE_ID?v=...
                const urlObj = new URL(url);
                const pathname = urlObj.pathname;

                // 경로에서 마지막 세그먼트 추출 (32자 hex 문자열)
                const segments = pathname.split('/').filter(s => s);
                const lastSegment = segments[segments.length - 1];

                // 32자 hex 문자열인지 확인 (하이픈 없는 UUID)
                if (lastSegment && /^[a-f0-9]{32}$/i.test(lastSegment)) {
                    return lastSegment;
                }

                // 하이픈 포함된 UUID 형식도 체크
                if (lastSegment && /^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i.test(lastSegment)) {
                    return lastSegment.replace(/-/g, '');
                }

                return null;
            } catch (e) {
                return null;
            }
        }

        // Notion에 저장 (URL 직접 입력)
        async function saveToNotionWithUrl() {
            const urlInput = document.getElementById('notionDbUrl');
            const notionUrl = urlInput.value.trim();

            if (!notionUrl) {
                showError('Notion 데이터베이스 URL을 입력해주세요.');
                return;
            }

            const databaseId = extractNotionDatabaseId(notionUrl);
            if (!databaseId) {
                showError('올바른 Notion 데이터베이스 URL을 입력해주세요.');
                return;
            }

            if (!generatedScript) {
                showError('저장할 스크립트가 없습니다. 먼저 스크립트를 생성해주세요.');
                return;
            }

            const btn = document.getElementById('btnSaveNotionNew');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="spinner" style="width:14px;height:14px;border-width:2px;margin:0;"></div>';
            btn.disabled = true;

            const instructorName = document.getElementById('generatedInstructorName').textContent;

            try {
                // Google Drive URL이 있으면 사용, 없으면 원본 URL 사용
                const videoUrlToSave = currentVideoData?.googleDriveUrl || currentVideoData?.video_url || currentVideoData?.url || '';

                const response = await fetch('/api/notion/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        databaseId: databaseId,
                        videoUrl: videoUrlToSave,
                        videoTitle: `[${instructorName}] ${currentVideoData?.title || '제목 없음'}`,
                        platform: currentVideoData?.platform || 'Unknown',
                        correctedText: generatedScript,
                        instructorName: instructorName
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // 성공 시 URL 저장
                    saveNotionUrl(notionUrl);
                    showSuccess('Notion에 저장되었습니다!');
                } else {
                    showError(data.error || 'Notion 저장에 실패했습니다.');
                }
            } catch (error) {
                console.error('Notion 저장 에러:', error);
                showError('Notion 저장 중 오류가 발생했습니다.');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // API 키 목록 로드
        async function loadAPIKeys() {
            try {
                const response = await fetch('/api/openai/keys');
                const data = await response.json();
                renderAPIKeyList(data.keys, data.status);
            } catch (error) {
                console.error('API 키 목록 로드 실패:', error);
            }
        }

        // API 키 목록 렌더링
        function renderAPIKeyList(keys, status) {
            const container = document.getElementById('apiKeyList');

            if (keys.length === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.4); font-size: 0.85rem; text-align: center; padding: 16px;">등록된 API 키가 없습니다.</p>';
                return;
            }

            let html = `<div style="margin-bottom: 8px; font-size: 0.8rem; color: rgba(255,255,255,0.5);">
                총 ${status.total}개 키 (사용 중: ${status.inUse}개)
            </div>`;

            keys.forEach((key, idx) => {
                html += `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-family: monospace; font-size: 0.85rem; color: rgba(255,255,255,0.8);">${key.masked}</span>
                        ${key.inUse ? '<span style="font-size: 0.7rem; padding: 2px 8px; background: rgba(139,92,246,0.3); border-radius: 4px; color: #a78bfa;">사용 중</span>' : ''}
                    </div>
                    <button onclick="removeAPIKey(${key.index})" style="background: rgba(239,68,68,0.2); border: none; color: #f87171; padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; cursor: pointer;">삭제</button>
                </div>`;
            });

            container.innerHTML = html;
        }

        // API 키 추가
        async function addOpenAIKey() {
            const apiKey = document.getElementById('openaiKeyInput').value.trim();

            if (!apiKey) {
                showError('API 키를 입력해주세요.');
                return;
            }

            if (!apiKey.startsWith('sk-')) {
                showError('올바른 OpenAI API 키 형식이 아닙니다.');
                return;
            }

            try {
                const response = await fetch('/api/openai/key', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey })
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess(data.message);
                    document.getElementById('openaiKeyInput').value = '';
                    loadAPIKeys();
                    transcribeAvailable = true;

                    const btnTranscribe = document.getElementById('btnTranscribe');
                    if (btnTranscribe) {
                        btnTranscribe.style.display = 'flex';
                    }
                } else {
                    showError(data.error || 'API 키 추가에 실패했습니다.');
                }
            } catch (error) {
                showError('API 키 추가 중 오류가 발생했습니다.');
                console.error(error);
            }
        }

        // API 키 삭제
        async function removeAPIKey(index) {
            if (!confirm('이 API 키를 삭제하시겠습니까?')) return;

            try {
                const response = await fetch(`/api/openai/key/${index}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess(data.message);
                    loadAPIKeys();
                    checkTranscribeStatus();
                } else {
                    showError(data.error || 'API 키 삭제에 실패했습니다.');
                }
            } catch (error) {
                showError('API 키 삭제 중 오류가 발생했습니다.');
                console.error(error);
            }
        }

        // 전사 설정 모달 표시
        function showOpenAIKeyBanner() {
            document.getElementById('openaiKeyModal').style.display = 'flex';

            // 이미 인증된 경우 바로 관리 화면 표시
            if (apiKeyAuthenticated) {
                document.getElementById('apiKeyAuthSection').style.display = 'none';
                document.getElementById('apiKeyManageSection').style.display = 'block';
                loadAPIKeys();
            } else {
                // 인증 화면 초기화
                document.getElementById('apiKeyAuthSection').style.display = 'block';
                document.getElementById('apiKeyManageSection').style.display = 'none';
                document.getElementById('apiKeyPassword').value = '';
                document.getElementById('apiKeyAuthError').style.display = 'none';
                setTimeout(() => document.getElementById('apiKeyPassword').focus(), 100);
            }
        }

        function closeOpenAIModal() {
            document.getElementById('openaiKeyModal').style.display = 'none';
        }

        // API 키 관리 비밀번호 확인
        let apiKeyAuthenticated = false;

        async function checkAPIKeyPassword() {
            const password = document.getElementById('apiKeyPassword').value;
            const errorEl = document.getElementById('apiKeyAuthError');

            if (!password) {
                errorEl.textContent = '비밀번호를 입력하세요.';
                errorEl.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                if (response.ok) {
                    apiKeyAuthenticated = true;
                    document.getElementById('apiKeyAuthSection').style.display = 'none';
                    document.getElementById('apiKeyManageSection').style.display = 'block';
                    loadAPIKeys();
                } else {
                    errorEl.textContent = '비밀번호가 틀렸습니다.';
                    errorEl.style.display = 'block';
                    document.getElementById('apiKeyPassword').value = '';
                }
            } catch (error) {
                errorEl.textContent = '서버 연결 오류';
                errorEl.style.display = 'block';
            }
        }

        // 브라우저 로그인 가능 여부 체크
        async function checkBrowserLoginAvailable() {
            try {
                const response = await fetch('/api/instagram/browser-available');
                const data = await response.json();
                if (!data.available) {
                    // 브라우저 로그인 불가 시 탭 숨기고 쿠키 입력만 표시
                    document.getElementById('tabLogin').style.display = 'none';
                    document.getElementById('authLogin').style.display = 'none';
                    document.getElementById('tabCookie').classList.add('active');
                    document.getElementById('authCookie').style.display = 'block';
                    // 탭 영역 자체를 숨김
                    document.querySelector('.auth-tabs').style.display = 'none';
                }
            } catch (error) {
                console.error('브라우저 로그인 체크 실패:', error);
            }
        }

        // Notion URL 로드
        async function loadNotionUrl() {
            try {
                const response = await fetch('/api/notion-url');
                const data = await response.json();
                if (data.success && data.url) {
                    document.getElementById('notionDbUrl').value = data.url;
                }
            } catch (error) {
                console.error('Notion URL 로드 실패:', error);
            }
        }

        // Notion URL 저장
        async function saveNotionUrl(url) {
            try {
                await fetch('/api/notion-url', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
            } catch (error) {
                console.error('Notion URL 저장 실패:', error);
            }
        }

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', () => {
            checkTranscribeStatus();
            checkGoogleDriveStatus();
            checkBrowserLoginAvailable();
            loadNotionUrl();
            loadInstructors();
        });

        // 탭 전환
        function showAuthTab(tab) {
            document.getElementById('tabLogin').classList.remove('active');
            document.getElementById('tabCookie').classList.remove('active');
            document.getElementById('authLogin').style.display = 'none';
            document.getElementById('authCookie').style.display = 'none';

            if (tab === 'login') {
                document.getElementById('tabLogin').classList.add('active');
                document.getElementById('authLogin').style.display = 'block';
            } else {
                document.getElementById('tabCookie').classList.add('active');
                document.getElementById('authCookie').style.display = 'block';
            }
        }

        // 로그인 창 열기
        async function openLoginWindow() {
            try {
                showSuccess('로그인 창을 여는 중...');
                const response = await fetch('/api/instagram/login', { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    showSuccess('로그인 성공! 다시 시도해주세요.');
                    document.getElementById('loginBanner').style.display = 'none';
                    // 이전에 실패한 URL 자동 재시도
                    if (lastFailedUrl) {
                        document.getElementById('urlInput').value = lastFailedUrl;
                        setTimeout(() => extractVideo(), 500);
                    }
                } else {
                    showError(data.error || '로그인에 실패했습니다.');
                }
            } catch (error) {
                showError('로그인 창을 열 수 없습니다.');
                console.error(error);
            }
        }

        // Instagram 실패시 배너 표시
        function showInstagramAuthBanner(url) {
            lastFailedUrl = url;
            document.getElementById('loginBanner').style.display = 'block';
            // 스크롤 이동
            document.getElementById('loginBanner').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        async function saveCookie() {
            const sessionid = document.getElementById('sessionidInput').value.trim();

            if (!sessionid) {
                showError('sessionid를 입력해주세요.');
                return;
            }

            try {
                const response = await fetch('/api/instagram/cookie', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sessionid })
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('쿠키가 저장되었습니다!');
                    document.getElementById('sessionidInput').value = '';
                    document.getElementById('loginBanner').style.display = 'none';
                    // 이전에 실패한 URL 자동 재시도
                    if (lastFailedUrl) {
                        document.getElementById('urlInput').value = lastFailedUrl;
                        setTimeout(() => extractVideo(), 500);
                    }
                } else {
                    showError(data.error || '쿠키 저장에 실패했습니다.');
                }
            } catch (error) {
                showError('쿠키 저장 중 오류가 발생했습니다.');
                console.error(error);
            }
        }

        function showCookieHelp() {
            document.getElementById('cookieHelpModal').style.display = 'flex';
        }

        function closeCookieHelp() {
            document.getElementById('cookieHelpModal').style.display = 'none';
        }

        // 새 링크 입력 시 기존 작업 상태 초기화
        function resetWorkState() {
            // 전사 상태 초기화
            currentTranscript = '';
            originalTranscript = '';
            isTranscriptCorrected = false;

            // 스크립트 상태 초기화
            generatedScript = '';

            // 전사 UI 초기화
            const transcribeContent = document.getElementById('transcribeContent');
            if (transcribeContent) {
                transcribeContent.textContent = '음성 전사 결과가 여기에 표시됩니다.';
            }

            // 전사 뱃지 초기화
            const transcribeBadge = document.getElementById('transcribeBadge');
            if (transcribeBadge) {
                transcribeBadge.textContent = '대기';
                transcribeBadge.style.background = 'rgba(100, 100, 100, 0.3)';
                transcribeBadge.style.color = 'rgba(255, 255, 255, 0.5)';
            }

            // GPT 교정 버튼 초기화
            const btnCorrect = document.getElementById('btnCorrect');
            if (btnCorrect) {
                btnCorrect.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg> GPT 교정`;
                btnCorrect.style.background = '';
                btnCorrect.style.borderColor = '';
                btnCorrect.style.color = '';
            }

            // 스크립트 UI 초기화
            const scriptOutput = document.getElementById('scriptOutput');
            if (scriptOutput) {
                scriptOutput.textContent = '스크립트가 여기에 생성됩니다.';
            }

            // 스크립트 뱃지 초기화
            const scriptBadge = document.getElementById('scriptBadge');
            if (scriptBadge) {
                scriptBadge.textContent = '대기';
                scriptBadge.style.background = 'rgba(100, 100, 100, 0.3)';
                scriptBadge.style.color = 'rgba(255, 255, 255, 0.5)';
            }

            // 강사 이름 초기화
            const generatedInstructorName = document.getElementById('generatedInstructorName');
            if (generatedInstructorName) {
                generatedInstructorName.textContent = '-';
            }
        }

        async function extractVideo() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();

            if (!url) {
                showError('URL을 입력해주세요.');
                return;
            }

            hideMessages();
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('extractBtn').disabled = true;

            try {
                const response = await fetch('/api/extract', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    currentVideoData = data.data;
                    lastFailedUrl = null; // 성공시 초기화
                    document.getElementById('loginBanner').style.display = 'none';
                    displayResult(data.data);

                    // 기존 작업 초기화
                    resetWorkState();

                    // 자동으로 음성 전사 실행
                    if (transcribeAvailable) {
                        setTimeout(() => {
                            transcribeVideo();
                        }, 500);
                    }
                } else {
                    // Instagram URL인 경우 인증 배너 표시
                    if (url.includes('instagram.com')) {
                        showInstagramAuthBanner(url);
                        showError('Instagram 로그인이 필요합니다. 위에서 로그인하세요.');
                    } else {
                        showError(data.error || '비디오를 추출할 수 없습니다.');
                    }
                }
            } catch (error) {
                showError('서버 연결에 실패했습니다.');
                console.error(error);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('extractBtn').disabled = false;
            }
        }

        function displayResult(data) {
            const videoPreview = document.getElementById('videoPreview');
            videoPreview.src = data.video_url;
            if (data.thumbnail_url) {
                videoPreview.poster = data.thumbnail_url;
            }

            document.getElementById('videoTitle').textContent = data.title || 'Video';

            const platformBadge = document.getElementById('videoPlatform');
            const platformNames = { youtube: 'YouTube', instagram: 'Instagram', facebook: 'Facebook', googleads: 'Google Ads' };
            platformBadge.textContent = platformNames[data.platform] || data.platform;
            platformBadge.className = `video-platform ${data.platform}`;

            document.getElementById('resultSection').style.display = 'block';
        }

        async function downloadVideo() {
            if (!currentVideoData?.video_url) {
                showError('다운로드할 비디오가 없습니다.');
                return;
            }

            const btn = document.querySelector('.btn-download');
            const originalHTML = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;margin:0;"></div> 준비 중...';

            try {
                const filename = `${currentVideoData.platform}_${Date.now()}.mp4`;
                const downloadUrl = `/api/proxy-download?url=${encodeURIComponent(currentVideoData.video_url)}&filename=${encodeURIComponent(filename)}`;

                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                showSuccess('다운로드가 시작되었습니다.');
            } catch (error) {
                showError('다운로드 중 오류가 발생했습니다.');
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalHTML;
                }, 1500);
            }
        }

        async function copyUrl() {
            if (!currentVideoData?.video_url) {
                showError('복사할 URL이 없습니다.');
                return;
            }

            const btn = document.querySelector('.btn-copy');
            const originalHTML = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;margin:0;"></div> 복사 중...';

            try {
                await navigator.clipboard.writeText(currentVideoData.video_url);
                btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> 복사됨!';
                showSuccess('비디오 URL이 클립보드에 복사되었습니다.');
            } catch (error) {
                const textArea = document.createElement('textarea');
                textArea.value = currentVideoData.video_url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> 복사됨!';
                showSuccess('비디오 URL이 클립보드에 복사되었습니다.');
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalHTML;
                }, 1500);
            }
        }

        function showError(message) {
            hideMessages();
            const errorMsg = document.getElementById('errorMsg');
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
        }

        function showSuccess(message) {
            hideMessages();
            const successMsg = document.getElementById('successMsg');
            successMsg.textContent = message;
            successMsg.style.display = 'block';
            setTimeout(() => { successMsg.style.display = 'none'; }, 3000);
        }

        function hideMessages() {
            document.getElementById('errorMsg').style.display = 'none';
            document.getElementById('successMsg').style.display = 'none';
        }

        document.getElementById('urlInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') extractVideo();
        });

        // URL 입력 시 플랫폼 감지
        document.getElementById('urlInput').addEventListener('input', (e) => {
            detectPlatform(e.target.value);
        });

        function detectPlatform(url) {
            // 모든 플랫폼 비활성화
            document.querySelectorAll('.platform-badge').forEach(badge => {
                badge.classList.remove('active');
            });

            if (!url) return;

            const urlLower = url.toLowerCase();

            if (urlLower.includes('youtube.com') || urlLower.includes('youtu.be')) {
                document.querySelector('.platform-badge.youtube').classList.add('active');
            } else if (urlLower.includes('instagram.com')) {
                document.querySelector('.platform-badge.instagram').classList.add('active');
            } else if (urlLower.includes('facebook.com') || urlLower.includes('fb.watch')) {
                document.querySelector('.platform-badge.facebook').classList.add('active');
            } else if (urlLower.includes('adstransparency.google.com')) {
                document.querySelector('.platform-badge.googleads').classList.add('active');
            }
        }

        // 전사 기능
        async function transcribeVideo() {
            if (!currentVideoData?.video_url) {
                showError('전사할 비디오가 없습니다.');
                return;
            }

            // API 키 없으면 설정 배너 표시
            if (!transcribeAvailable) {
                showOpenAIKeyBanner();
                showError('OpenAI API 키를 먼저 설정해주세요.');
                return;
            }

            const btn = document.getElementById('btnTranscribe');
            const section = document.getElementById('transcribeSection');
            const content = document.getElementById('transcribeContent');

            btn.disabled = true;
            btn.innerHTML = '<div class="spinner" style="width:16px;height:16px;border-width:2px;margin:0;"></div> 전사 중...';
            section.style.display = 'block';
            content.innerHTML = '<div class="transcribe-loading"><div class="spinner"></div> 음성을 텍스트로 변환하는 중... (1-2분 소요)</div>';
            // 빈 상태 숨기기
            const emptyState = document.getElementById('transcribeEmpty');
            if (emptyState) emptyState.style.display = 'none';

            try {
                // 제목을 prompt 힌트로 전달 (발음 인식 정확도 향상)
                const prompt = currentVideoData.title || '';

                // 선택된 언어 가져오기
                const selectedLang = document.getElementById('transcribeLang').value;

                const response = await fetch('/api/transcribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        videoUrl: currentVideoData.video_url,
                        language: selectedLang,  // 빈 문자열이면 자동 감지
                        prompt: prompt
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    currentTranscript = data.text;
                    content.textContent = data.text;
                    updateTranscribeUI(true);
                    showSuccess('전사가 완료되었습니다.');
                } else {
                    const errorMsg = data.error || '알 수 없는 오류가 발생했습니다';
                    content.innerHTML = `<span style="color: #f87171;">오류: ${errorMsg}</span>`;
                    updateTranscribeUI(true); // 에러 메시지도 표시
                    showError(errorMsg);
                }
            } catch (error) {
                content.innerHTML = `<span style="color: #f87171;">전사 중 오류가 발생했습니다.</span>`;
                showError('전사 중 오류가 발생했습니다.');
                console.error(error);
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.42 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg> 전사 시작`;
            }
        }

        async function copyTranscript() {
            if (!currentTranscript) {
                showError('복사할 내용이 없습니다.');
                return;
            }

            try {
                await navigator.clipboard.writeText(currentTranscript);
                showSuccess('전사 내용이 복사되었습니다.');
            } catch (error) {
                const textArea = document.createElement('textarea');
                textArea.value = currentTranscript;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showSuccess('전사 내용이 복사되었습니다.');
            }
        }

        // GPT 요약 기능
        let beforeSummary = '';  // 요약 전 원본 저장
        let isTranscriptSummarized = false;

        async function summarizeTranscript() {
            const btn = document.getElementById('btnSummarize');

            // 이미 요약된 상태면 요약 전/후 비교 모달 표시
            if (isTranscriptSummarized) {
                showSummaryDiffModal();
                return;
            }

            if (!currentTranscript) {
                showError('요약할 내용이 없습니다.');
                return;
            }

            // 짧은 글은 요약 불필요 안내 (1000byte 미만)
            if (new TextEncoder().encode(currentTranscript).length < 1000) {
                showError('이 정도 길이는 직접 읽어보시는 게 좋을 것 같습니다 😊');
                return;
            }

            const content = document.getElementById('transcribeContent');

            btn.disabled = true;
            btn.innerHTML = '<div class="spinner" style="width:14px;height:14px;border-width:2px;margin:0;"></div>';

            try {
                // 원본 저장
                beforeSummary = currentTranscript;

                const response = await fetch('/api/summarize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: currentTranscript })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    currentTranscript = data.summarized;
                    content.textContent = data.summarized;
                    isTranscriptSummarized = true;

                    // 버튼 텍스트 변경
                    btn.innerHTML = '요약 전/후';
                    btn.style.background = 'linear-gradient(135deg, rgba(16,185,129,0.2), rgba(5,150,105,0.2))';
                    btn.style.borderColor = 'rgba(16,185,129,0.3)';
                    btn.style.color = '#6ee7b7';

                    showSuccess('요약 완료! 버튼을 눌러 비교해보세요.');
                } else {
                    showError(data.error || '요약 실패');
                    btn.innerHTML = '요약';
                }
            } catch (error) {
                showError('요약 중 오류가 발생했습니다.');
                console.error(error);
                btn.innerHTML = '요약';
            } finally {
                btn.disabled = false;
            }
        }

        function showSummaryDiffModal() {
            const diffContent = document.getElementById('diffContent');
            // 요약은 완전히 다른 텍스트이므로 전/후 나란히 표시
            diffContent.innerHTML = `
                <div style="margin-bottom: 16px;">
                    <div style="color: rgba(255,255,255,0.5); font-size: 0.8rem; margin-bottom: 8px;">원본:</div>
                    <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; font-size: 0.85rem; line-height: 1.8; max-height: 200px; overflow-y: auto;">${escapeHtml(beforeSummary)}</div>
                </div>
                <div>
                    <div style="color: rgba(110,231,183,0.8); font-size: 0.8rem; margin-bottom: 8px;">요약:</div>
                    <div style="background: rgba(110,231,183,0.1); padding: 12px; border-radius: 8px; font-size: 0.85rem; line-height: 1.8; border: 1px solid rgba(110,231,183,0.2);">${escapeHtml(currentTranscript)}</div>
                </div>
            `;
            document.getElementById('diffModal').style.display = 'flex';
        }

        // GPT 번역 기능
        let beforeTranslation = '';  // 번역 전 원본 저장
        let isTranscriptTranslated = false;

        async function translateTranscript() {
            const btn = document.getElementById('btnTranslate');

            // 이미 번역된 상태면 번역 전/후 비교 모달 표시
            if (isTranscriptTranslated) {
                showTranslateDiffModal();
                return;
            }

            if (!currentTranscript) {
                showError('번역할 내용이 없습니다.');
                return;
            }

            const content = document.getElementById('transcribeContent');

            btn.disabled = true;
            btn.innerHTML = '<div class="spinner" style="width:14px;height:14px;border-width:2px;margin:0;"></div>';

            try {
                // 원본 저장
                beforeTranslation = currentTranscript;

                const response = await fetch('/api/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: currentTranscript })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    currentTranscript = data.translated;
                    content.textContent = data.translated;
                    isTranscriptTranslated = true;

                    // 버튼 텍스트 변경
                    btn.innerHTML = '번역 전/후';
                    btn.style.background = 'linear-gradient(135deg, rgba(16,185,129,0.2), rgba(5,150,105,0.2))';
                    btn.style.borderColor = 'rgba(16,185,129,0.3)';
                    btn.style.color = '#6ee7b7';

                    showSuccess('번역 완료! 버튼을 눌러 비교해보세요.');
                } else {
                    showError(data.error || '번역 실패');
                    btn.innerHTML = '번역';
                }
            } catch (error) {
                showError('번역 중 오류가 발생했습니다.');
                console.error(error);
                btn.innerHTML = '번역';
            } finally {
                btn.disabled = false;
            }
        }

        function showTranslateDiffModal() {
            const diffContent = document.getElementById('diffContent');
            diffContent.innerHTML = computeInlineDiff(beforeTranslation, currentTranscript);
            document.getElementById('diffModal').style.display = 'flex';
        }

        // GPT 교정 기능
        let originalTranscript = '';  // 교정 전 원본 저장
        let isTranscriptCorrected = false;

        async function correctTranscript() {
            const btn = document.getElementById('btnCorrect');
            const generateBtn = document.getElementById('btnGenerateScript');

            // 이미 교정된 상태면 비교 모달 표시
            if (isTranscriptCorrected) {
                showDiffModal();
                return;
            }

            if (!currentTranscript) {
                showError('교정할 내용이 없습니다.');
                return;
            }

            const content = document.getElementById('transcribeContent');

            btn.disabled = true;
            btn.innerHTML = '<div class="spinner" style="width:14px;height:14px;border-width:2px;margin:0;"></div>';

            // 뱃지 상태 변경 - 교정중
            const badge = document.getElementById('transcribeBadge');
            if (badge) {
                badge.textContent = '교정중';
                badge.style.background = 'rgba(251, 191, 36, 0.3)';
                badge.style.color = '#fbbf24';
            }

            // 교정 중에는 스크립트 생성 버튼 비활성화
            if (generateBtn) {
                generateBtn.disabled = true;
                generateBtn.style.opacity = '0.5';
                generateBtn.style.cursor = 'not-allowed';
            }

            try {
                // 원본 저장
                originalTranscript = currentTranscript;

                const response = await fetch('/api/correct', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: currentTranscript })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    currentTranscript = data.corrected;
                    content.textContent = data.corrected;
                    isTranscriptCorrected = true;

                    // 버튼 텍스트 변경
                    btn.innerHTML = '교정 전/후';
                    btn.style.background = 'linear-gradient(135deg, rgba(16,185,129,0.2), rgba(5,150,105,0.2))';
                    btn.style.borderColor = 'rgba(16,185,129,0.3)';
                    btn.style.color = '#6ee7b7';

                    // 뱃지 상태 변경 - 교정완료
                    if (badge) {
                        badge.textContent = '교정완료';
                        badge.style.background = 'rgba(16, 185, 129, 0.3)';
                        badge.style.color = '#6ee7b7';
                    }

                    showSuccess('GPT 교정 완료! 버튼을 눌러 비교해보세요.');
                } else {
                    showError(data.error || '교정 실패');
                    btn.innerHTML = 'GPT 교정';
                    // 뱃지 원래대로
                    if (badge) {
                        badge.textContent = '완료';
                        badge.style.background = 'rgba(16, 185, 129, 0.3)';
                        badge.style.color = '#6ee7b7';
                    }
                }
            } catch (error) {
                showError('교정 중 오류가 발생했습니다.');
                console.error(error);
                btn.innerHTML = 'GPT 교정';
                // 뱃지 원래대로
                if (badge) {
                    badge.textContent = '완료';
                    badge.style.background = 'rgba(16, 185, 129, 0.3)';
                    badge.style.color = '#6ee7b7';
                }
            } finally {
                btn.disabled = false;
                // 스크립트 생성 버튼 다시 활성화
                if (generateBtn) {
                    generateBtn.disabled = false;
                    generateBtn.style.opacity = '1';
                    generateBtn.style.cursor = 'pointer';
                }
            }
        }

        function showDiffModal() {
            const diffContent = document.getElementById('diffContent');
            diffContent.innerHTML = computeInlineDiff(originalTranscript, currentTranscript);
            document.getElementById('diffModal').style.display = 'flex';
        }

        function closeDiffModal() {
            document.getElementById('diffModal').style.display = 'none';
        }

        // 인라인 diff 계산 (단어 단위, 삭제/추가 모두 본문에 표시)
        function computeInlineDiff(oldText, newText) {
            // 단어와 공백을 분리해서 추출
            const tokenize = (text) => text.split(/(\s+)/).filter(t => t);
            const oldTokens = tokenize(oldText);
            const newTokens = tokenize(newText);

            // 단어만 추출 (비교용)
            const getWord = (token) => token.replace(/[^가-힣a-zA-Z0-9]/g, '');

            // LCS 계산
            const oldWords = oldTokens.map(getWord).filter(w => w);
            const newWords = newTokens.map(getWord).filter(w => w);
            const lcs = computeLCS(oldWords, newWords);

            // diff 결과 생성
            let result = '';
            let oldIdx = 0;
            let newIdx = 0;
            let lcsIdx = 0;

            // oldTokens에서 단어 인덱스 매핑
            const oldWordIndices = [];
            oldTokens.forEach((token, idx) => {
                if (getWord(token)) oldWordIndices.push(idx);
            });

            // newTokens에서 단어 인덱스 매핑
            const newWordIndices = [];
            newTokens.forEach((token, idx) => {
                if (getWord(token)) newWordIndices.push(idx);
            });

            let oldWordIdx = 0;
            let newWordIdx = 0;

            while (oldWordIdx < oldWords.length || newWordIdx < newWords.length) {
                if (lcsIdx < lcs.length) {
                    // 삭제된 단어들 (old에서 lcs까지)
                    while (oldWordIdx < oldWords.length && oldWords[oldWordIdx] !== lcs[lcsIdx]) {
                        const token = oldTokens[oldWordIndices[oldWordIdx]];
                        result += `<span style="color: #f87171; text-decoration: line-through; background: rgba(248,113,113,0.15); padding: 1px 3px; border-radius: 3px;">${escapeHtml(token)}</span> `;
                        oldWordIdx++;
                    }

                    // 추가된 단어들 (new에서 lcs까지)
                    while (newWordIdx < newWords.length && newWords[newWordIdx] !== lcs[lcsIdx]) {
                        const token = newTokens[newWordIndices[newWordIdx]];
                        result += `<span style="color: #6ee7b7; background: rgba(110,231,183,0.15); padding: 1px 3px; border-radius: 3px;">${escapeHtml(token)}</span> `;
                        newWordIdx++;
                    }

                    // 공통 단어
                    if (oldWordIdx < oldWords.length && newWordIdx < newWords.length) {
                        const token = newTokens[newWordIndices[newWordIdx]];
                        result += escapeHtml(token) + ' ';
                        oldWordIdx++;
                        newWordIdx++;
                        lcsIdx++;
                    }
                } else {
                    // LCS 끝난 후 남은 삭제 단어
                    while (oldWordIdx < oldWords.length) {
                        const token = oldTokens[oldWordIndices[oldWordIdx]];
                        result += `<span style="color: #f87171; text-decoration: line-through; background: rgba(248,113,113,0.15); padding: 1px 3px; border-radius: 3px;">${escapeHtml(token)}</span> `;
                        oldWordIdx++;
                    }

                    // LCS 끝난 후 남은 추가 단어
                    while (newWordIdx < newWords.length) {
                        const token = newTokens[newWordIndices[newWordIdx]];
                        result += `<span style="color: #6ee7b7; background: rgba(110,231,183,0.15); padding: 1px 3px; border-radius: 3px;">${escapeHtml(token)}</span> `;
                        newWordIdx++;
                    }
                }
            }

            return result || escapeHtml(newText);
        }

        // LCS 계산
        function computeLCS(arr1, arr2) {
            const m = arr1.length;
            const n = arr2.length;
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (arr1[i - 1] === arr2[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                    }
                }
            }

            // LCS 역추적
            const lcs = [];
            let i = m, j = n;
            while (i > 0 && j > 0) {
                if (arr1[i - 1] === arr2[j - 1]) {
                    lcs.unshift(arr1[i - 1]);
                    i--;
                    j--;
                } else if (dp[i - 1][j] > dp[i][j - 1]) {
                    i--;
                } else {
                    j--;
                }
            }

            return lcs;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 교정/번역/요약 상태 초기화 (새 비디오 추출 시)
        function resetCorrectionState() {
            // 교정 상태 초기화
            originalTranscript = '';
            isTranscriptCorrected = false;
            const btnCorrect = document.getElementById('btnCorrect');
            if (btnCorrect) {
                btnCorrect.innerHTML = 'GPT 교정';
                btnCorrect.style.background = 'linear-gradient(135deg, rgba(139,92,246,0.2), rgba(99,102,241,0.2))';
                btnCorrect.style.borderColor = 'rgba(139,92,246,0.3)';
                btnCorrect.style.color = '#a78bfa';
            }

            // 번역 상태 초기화
            beforeTranslation = '';
            isTranscriptTranslated = false;
            const btnTranslate = document.getElementById('btnTranslate');
            if (btnTranslate) {
                btnTranslate.innerHTML = '번역';
                btnTranslate.style.background = 'linear-gradient(135deg, rgba(59,130,246,0.2), rgba(37,99,235,0.2))';
                btnTranslate.style.borderColor = 'rgba(59,130,246,0.3)';
                btnTranslate.style.color = '#60a5fa';
            }

            // 요약 상태 초기화
            beforeSummary = '';
            isTranscriptSummarized = false;
            const btnSummarize = document.getElementById('btnSummarize');
            if (btnSummarize) {
                btnSummarize.innerHTML = '요약';
                btnSummarize.style.background = 'linear-gradient(135deg, rgba(245,158,11,0.2), rgba(217,119,6,0.2))';
                btnSummarize.style.borderColor = 'rgba(245,158,11,0.3)';
                btnSummarize.style.color = '#fbbf24';
            }
        }

        // 비디오 추출 성공 시 전사 섹션 숨기기 및 교정 상태 초기화
        const originalDisplayResult = displayResult;
        displayResult = function(data) {
            document.getElementById('transcribeSection').style.display = 'none';
            currentTranscript = '';
            resetCorrectionState();
            originalDisplayResult(data);
        };
    </script>
</body>
</html>
